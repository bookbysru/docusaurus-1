<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Docker · Open Power Quality</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Docker · Open Power Quality"/><meta property="og:type" content="website"/><meta property="og:url" content="https://openpowerquality.org/index.html"/><meta property="og:description" content="## Overview"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/opq.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://openpowerquality.org/blog/atom.xml" title="Open Power Quality Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://openpowerquality.org/blog/feed.xml" title="Open Power Quality Blog RSS Feed"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Gugi"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type="text/javascript" src="/js/mathjax-config.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible doc separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/opqlogo_white.png" alt="Open Power Quality"/><h2 class="headerTitleWithLogo">Open Power Quality</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/intro-motivation.html" target="_self">Documentation</a></li><li class="siteNavGroupActive"><a href="/docs/other-opportunities.html" target="_self">Opportunities</a></li><li class=""><a href="/blog" target="_self">News</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Developer Guide: OPQ Cloud</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Introduction</h3><ul><li class="navListItem"><a class="navItem" href="/docs/intro-motivation.html">Motivation for OPQ</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-power-quality.html">A beginner&#x27;s guide to power quality</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-system-architecture.html">OPQ System Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-information-architecture.html">OPQ Information Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-related-work.html">Related Work</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-bibliography.html">Bibliography</a></li></ul></div><div class="navGroup navGroupActive"><h3>User Guide</h3><ul><li class="navListItem"><a class="navItem" href="/docs/userguide-hardware.html">OPQ Box</a></li><li class="navListItem"><a class="navItem" href="/docs/userguide-software.html">OPQ Cloud</a></li></ul></div><div class="navGroup navGroupActive"><h3>Developer Guide: OPQ Box</h3><ul><li class="navListItem"><a class="navItem" href="/docs/box-overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/box-hardware-design.html">Hardware Design</a></li><li class="navListItem"><a class="navItem" href="/docs/box-software-design.html">Software Design</a></li><li class="navListItem"><a class="navItem" href="/docs/box-updater.html">Updater</a></li><li class="navListItem"><a class="navItem" href="/docs/box-manufacturing.html">Manufacturing</a></li></ul></div><div class="navGroup navGroupActive"><h3>Developer Guide: OPQ Cloud</h3><ul><li class="navListItem"><a class="navItem" href="/docs/cloud-overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-installation.html">Installation</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-datamodel.html">Data Model</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-view.html">View</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-mauka.html">Mauka</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-makai.html">Makai</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-health.html">Health</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-protocol.html">Protocol</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-port-map.html">Port Map</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/docs/cloud-docker.html">Docker</a></li></ul></div><div class="navGroup navGroupActive"><h3>Developer Guide: Emilia</h3><ul><li class="navListItem"><a class="navItem" href="/docs/emilia-ssh.html">SSH</a></li><li class="navListItem"><a class="navItem" href="/docs/emilia-docker.html">Docker</a></li><li class="navListItem"><a class="navItem" href="/docs/emilia-mongodb.html">MongoDB</a></li><li class="navListItem"><a class="navItem" href="/docs/emilia-mauka.html">Mauka</a></li><li class="navListItem"><a class="navItem" href="/docs/emilia-makai.html">Makai</a></li><li class="navListItem"><a class="navItem" href="/docs/emilia-view.html">View</a></li><li class="navListItem"><a class="navItem" href="/docs/emilia-health.html">Health</a></li></ul></div><div class="navGroup navGroupActive"><h3>Developer Guide: Misc</h3><ul><li class="navListItem"><a class="navItem" href="/docs/developerguide-docusaurus.html">Documentation</a></li><li class="navListItem"><a class="navItem" href="/docs/developerguide-virtual-machine.html">VM &amp; Sim</a></li><li class="navListItem"><a class="navItem" href="/docs/developerguide-bibliography.html">Bibliography</a></li></ul></div><div class="navGroup navGroupActive"><h3>Other</h3><ul><li class="navListItem"><a class="navItem" href="/docs/other-roadmap.html">Roadmap</a></li><li class="navListItem"><a class="navItem" href="/docs/other-opportunities.html">R&amp;D Opportunities</a></li><li class="navListItem"><a class="navItem" href="/docs/other-agile-power-monitoring.html">Agile Power Monitoring for UH</a></li><li class="navListItem"><a class="navItem" href="/docs/other-g1-pilot-study.html">G1 Pilot Study (2014)</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Docker</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="overview"></a><a href="#overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h2>
<p>We utilize <a href="https://www.docker.com/">Docker</a> and <a href="https://docs.docker.com/compose/">Docker Compose</a> to containerize and deploy the OPQ Services: View, Mauka, Makai, Health, and Box Updater.  For Mongo, we use the official Mongo image without modification.</p>
<h2><a class="anchor" aria-hidden="true" id="docker-and-docker-compose"></a><a href="#docker-and-docker-compose" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker and Docker Compose</h2>
<p>Make sure you have Docker and Docker-Compose installed on your development and production systems.</p>
<p>Please refer to the official <a href="https://docs.docker.com/install/">Docker documentation</a> for installation instructions.</p>
<p>Also see the official <a href="https://docs.docker.com/compose/install/">Docker-Compose documentation</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="docker-file-structure"></a><a href="#docker-file-structure" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker file structure</h2>
<p>Each dockerized OPQ service has its own <code>/docker</code> subdirectory containing scripts that simplify the task of building and publishing Docker images.</p>
<p>When building and publishing a new image for an OPQ service, there are three files that you need to be concerned about:</p>
<ol>
<li>The <code>docker-build.sh</code> script, found in the <code>opq/&lt;service-name&gt;/docker</code> directory.</li>
<li>The <code>docker-publish.sh</code> script, also found in the <code>opq/&lt;service-name&gt;/docker</code> directory.</li>
<li>The <code>.env</code> file, found in the <code>opq/util/docker-deployment</code> directory.</li>
</ol>
<p>The <code>.env</code> file is a special Docker-Compose file that we also utilize when publishing new images.</p>
<p>See the 'Understanding Docker-Compose and the .env file' section further below if you wish to learn more about this important file.</p>
<h2><a class="anchor" aria-hidden="true" id="build-an-image"></a><a href="#build-an-image" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Build an image</h2>
<p>Building a new Docker image for a given OPQ service is simply just a matter of invoking its <code>docker-build.sh</code> script.</p>
<p>To build a new Docker image for a given OPQ service:</p>
<ol>
<li><code>cd</code> into the service's <code>/docker</code> subdirectory (e.g. opq/view/docker).</li>
<li>Invoke the <code>docker-build.sh</code> script, and wait for the build process to complete.</li>
</ol>
<p>Each OPQ service's respective <code>docker-build.sh</code> script might have varying output due to differences in that service's build process, but the end result will always be the same: a new Docker image named <code>&lt;opq-service-name&gt;:latest</code>.</p>
<p>Once the script has finished running, you should confirm that the image has been successfully created by invoking the <code>docker image ls</code> command.</p>
<p>Since our build scripts do not explicitly provide an image tag for the build process, the <code>latest</code> tag is automatically provided for us.
You can also confirm this by invoking the <code>docker image ls</code> command.</p>
<p>This is important to note, because each OPQ service's <code>docker-publish.sh</code> script will, by default, rename and push this <code>&lt;opq-service-name&gt;:latest</code> image to DockerHub.</p>
<h2><a class="anchor" aria-hidden="true" id="publish-image-to-dockerhub"></a><a href="#publish-image-to-dockerhub" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Publish image to DockerHub</h2>
<p>First, make sure that your DockerHub account is a member of the official <code>openpowerquality</code> DockerHub organization.</p>
<p>Publishing a new Docker image for a given OPQ service involves the following steps:</p>
<ol>
<li><p>If publishing a <strong>new</strong> version of an image, modify the appropriate variable in the <code>opq/util/docker-deployment/.env</code> file with the new image version tag.</p></li>
<li><p>Login to your OPQ DockerHub account by invoking <code>docker login</code> and enter your credentials.</p></li>
<li><p><code>cd</code> into the service's <code>/docker</code> subdirectory (e.g. <code>opq/mauka/docker</code>) and invoke the <code>docker-publish.sh</code> script.</p></li>
<li><p>If you modified the <code>.env</code> file, commit and push it to GitHub with a useful message (e.g. <code>Publish Mauka 0.1.1</code>).</p></li>
</ol>
<p>As we explain in the 'Understanding Docker-Compose and the .env file' section further below, the <code>.env</code> file is actually a special Docker-Compose file.  For now, you just need to understand that the <code>.env</code> file has an environment variable definition for each OPQ service's DockerHub repository image name.</p>
<p>Each OPQ service's <code>docker-publish.sh</code> script parses the <code>.env</code> file for the appropriate image name variable so that it knows exactly how to tag and push the new image.</p>
<h2><a class="anchor" aria-hidden="true" id="publish-example"></a><a href="#publish-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Publish example</h2>
<p>Assume that we just created a new Mauka image by invoking its <code>docker-build.sh</code> script.
The newly created image is automatically named <code>mauka:latest</code>, which you can confirm by invoking <code>docker image ls</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="update-the-env-file"></a><a href="#update-the-env-file" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Update the <code>.env</code> file</h3>
<p>Our goal is to publish this new image to DockerHub, also giving it a new version <code>0.1.1</code> (previously <code>0.1.0</code>)</p>
<p><strong>Prior</strong> to publishing the new Mauka image, the <code>.env</code> file (found in <code>opq/util/docker-deployment</code>) might look like the following:</p>
<pre><code class="hljs"><span class="hljs-attr">MAUKA_IMAGE</span>=openpowerquality/mauka:<span class="hljs-number">0.1</span>.<span class="hljs-number">0</span>
<span class="hljs-attr">HEALTH_IMAGE</span>=openpowerquality/health:<span class="hljs-number">0.1</span>.<span class="hljs-number">0</span>
<span class="hljs-attr">VIEW_IMAGE</span>=openpowerquality/view:<span class="hljs-number">0.1</span>.<span class="hljs-number">0</span>
</code></pre>
<p>With the goal of publishing a new Mauka image (version 0.1.1), simply modify the <code>MAUKA_IMAGE</code> variable in the <code>.env</code> file, like so:</p>
<pre><code class="hljs"><span class="hljs-attr">MAUKA_IMAGE</span>=openpowerquality/mauka:<span class="hljs-number">0.1</span>.<span class="hljs-number">1</span>
<span class="hljs-attr">HEALTH_IMAGE</span>=openpowerquality/health:<span class="hljs-number">0.1</span>.<span class="hljs-number">0</span>
<span class="hljs-attr">VIEW_IMAGE</span>=openpowerquality/view:<span class="hljs-number">0.1</span>.<span class="hljs-number">0</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="login-to-dockerhub"></a><a href="#login-to-dockerhub" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Login to DockerHub</h3>
<p>Login to your DockerHub account by invoking the <code>docker login</code> command.</p>
<p>If you are unsure which account you are currently logged into, you may invoke <code>docker logout</code> first.</p>
<pre><code class="hljs">$ docker login
Login <span class="hljs-keyword">with</span> your Docker ID <span class="hljs-keyword">to</span> push <span class="hljs-keyword">and</span> pull images <span class="hljs-keyword">from</span> Docker Hub. <span class="hljs-keyword">If</span> you don<span class="hljs-comment">'t have a Docker ID, head over to https://hub.docker.com to create one.</span>
Username: &lt;Your-Username&gt;
Password:
&lt;some lines removed&gt;

Login Succeeded
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="invoke-the-publish-script"></a><a href="#invoke-the-publish-script" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Invoke the publish script</h3>
<p>We're publishing a new Mauka image, so <code>cd</code> into <code>opq/mauka/docker</code> and invoke the <code>docker-publish.sh</code> script.</p>
<p>When you invoke the <code>docker-publish.sh</code> script, it will provide information on how the image will be tagged, and give you an opportunity to abort the script should you need to make modifications.</p>
<p>As you can see below, the <code>docker-publish.sh</code> script simply tags the most recently created local Mauka image <code>mauka:latest</code> as <code>openpowerquality/mauka:0.1.1</code> (as defined in the <code>.env</code> file), and pushes it to DockerHub.</p>
<p>Reminder: As we briefly explained in the 'Creating new Docker images' section, whenever you create a new image with the <code>docker-build.sh</code> script, Docker will automatically tag that new image with <code>latest</code>.</p>
<pre><code class="hljs">$ cd opq/mauka/docker
$ ./docker-publish.sh
=&gt; This will tag the 'mau<span class="hljs-symbol">ka:la</span>test' image as 'openpowerquality/mau<span class="hljs-symbol">ka:0</span>.<span class="hljs-number">1.1</span>' <span class="hljs-built_in">and</span> push to your Docker registry.
=&gt; <span class="hljs-built_in">If</span> you need to change the destination image tag (openpowerquality/mau<span class="hljs-symbol">ka:0</span>.<span class="hljs-number">1.1</span>), you can abort this script
<span class="hljs-built_in">and</span> modify the 'MAUKA_IMAGE' variable found in the 'opq/util/docker-deployment/.env' file.
=&gt; In addition, please ensure that you are logged into your DockerHub account before continuing.
=&gt; Continue? (y/<span class="hljs-built_in">n</span>)<span class="hljs-symbol">:</span> y
</code></pre>
<p>In our case, everything looks good, so we enter <code>y</code> to continue, and the image is then pushed to DockerHub!</p>
<pre><code class="hljs">=&gt; Tagging <span class="hljs-string">'mauka:latest'</span> image <span class="hljs-keyword">as</span> <span class="hljs-string">'openpowerquality/mauka:0.1.1'</span>...
=&gt; Pushing the <span class="hljs-string">'openpowerquality/mauka:0.1.1'</span> image <span class="hljs-keyword">to</span> registry...
The push refers <span class="hljs-keyword">to</span> repository [docker.io/openpowerquality/mauka]
<span class="hljs-number">3</span>c64a2f29066: Pushed
c40f7a899b1c: Pushed
<span class="hljs-number">16</span>cb62492495: Pushed
c9701db5aa5<span class="hljs-variable">b:</span> Layer already <span class="hljs-built_in">exists</span>
<span class="hljs-number">590</span>ee04d598<span class="hljs-variable">a:</span> Layer already <span class="hljs-built_in">exists</span>
a62b97ef6d9f: Layer already <span class="hljs-built_in">exists</span>
be59bd55864<span class="hljs-variable">a:</span> Layer already <span class="hljs-built_in">exists</span>
a19cb627cc73: Layer already <span class="hljs-built_in">exists</span>
ab016c9ea8f8: Layer already <span class="hljs-built_in">exists</span>
<span class="hljs-number">2</span>eb1c9bfc5e<span class="hljs-variable">a:</span> Layer already <span class="hljs-built_in">exists</span>
<span class="hljs-number">0</span>b703c74a09c: Layer already <span class="hljs-built_in">exists</span>
b28ef0b6fef8: Layer already <span class="hljs-built_in">exists</span>
<span class="hljs-number">0.1</span>.<span class="hljs-number">1</span>: diges<span class="hljs-variable">t:</span> <span class="hljs-built_in">sha256</span>:<span class="hljs-number">91</span>d592e4cc9c2febdfaf689a53d7a70a755de944801756b6015fdd974f41a1c4 size: <span class="hljs-number">2849</span>
</code></pre>
<p>Note: The <code>Layer already exists</code> messages are normal and should be expected. Docker images are built on layers, and knows how to effectively reuse layers from pre-existing images.</p>
<p>The image is now published!
You can visit the <a href="https://hub.docker.com/u/openpowerquality">official OPQ DockerHub</a> page to double check that your new image has been successfully published.</p>
<h3><a class="anchor" aria-hidden="true" id="commit-and-push-the-updated-env-file-to-github"></a><a href="#commit-and-push-the-updated-env-file-to-github" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Commit and push the updated <code>.env</code> file to GitHub</h3>
<p>As a final step, if you have modified the <code>.env</code> file in order to publish a new version (as we did in the Mauka example),
be sure to commit and push the file to GitHub with a useful commit message (e.g. <code>Publish Mauka 0.1.1</code>).</p>
<p>By doing so, we accomplish two useful things:</p>
<ol>
<li>The world is aware of the latest available Docker image versions for each OPQ service.</li>
<li>We can easily correlate OPQ releases with Git history.</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="overview-of-opq-docker-files"></a><a href="#overview-of-opq-docker-files" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview of OPQ Docker files</h2>
<p>There are two kinds of Docker-related files to be aware of:</p>
<ol>
<li>Individual OPQ service Docker files, found in each service's respective <code>/docker</code> subdirectory (e.g. <code>opq/view/docker</code>).</li>
<li>Docker deployment utility files, found in the <code>opq/util/docker-utils</code> directory.</li>
<li>Docker installation scripts, found in the openpowerquality/docker repository.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="opq-cloud-docker-files"></a><a href="#opq-cloud-docker-files" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OPQ Cloud Docker files</h3>
<p>Each OPQ Cloud service has a <code>/docker</code> subdirectory with a common set of files:</p>
<ul>
<li><code>Dockerfile</code>: Contains the configuration for building the Docker image. Used by the <code>docker-build.sh</code> script.</li>
<li><code>docker-build.sh</code>: A script for building a new Docker image.</li>
<li><code>docker-publish.sh</code>: A script for publishing a new image to DockerHub.</li>
<li><code>docker-run.sh</code>: A script for running the docker image as a standalone instance. Note that we actually use Docker-Compose to handle the task of running all OPQ images together, so this file is generally only used for debugging purposes.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="docker-compose-files"></a><a href="#docker-compose-files" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker-Compose files</h3>
<p>Docker-Compose is responsible for orchestrating how each of our OPQ services work together.</p>
<p>These files can be found in the openpowerquality/docker repository.</p>
<ul>
<li><code>docker-compose.yml</code>: The configuration file for Docker-Compose.</li>
<li><code>.env</code>: Contains environment variables that are substituted into the docker-compose.yml file.</li>
<li><code>docker-compose-run.sh</code>: A script for launching Docker-Compose. Also defines additional environment variables.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="utility-files"></a><a href="#utility-files" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Utility files</h3>
<p>The files found in the <code>opq/util/docker-utils</code> directory are helper scripts meant to aid with the deployment of OPQ on the Emilia server:</p>
<ul>
<li><code>deploy-transfer.sh</code>: Transfers latest deployment related files to the Emilia server.</li>
<li><code>docker-prepare-and-run.sh</code>: Helper script that copies (and overwrites existing) deployment files into the dedicated deployment directory on Emilia, before invoking the <code>docker-compose-run.sh</code> script to initiate (re)deployment.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="understanding-docker-compose-and-the-env-file-"></a><a href="#understanding-docker-compose-and-the-env-file-" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Understanding Docker-Compose and the .env file</h2>
<p>The openpowerquality/docker repository contains all of the Docker-Compose related files, the most important of which is the <code>docker-compose.yml</code> file.</p>
<p>The <code>docker-compose.yml</code> file is the configuration file for Docker-Compose, which is responsible for orchestrating how each of our OPQ services work together. Among other things, this is where we define the Docker image to use for each service.</p>
<p>Rather than hard-coding each OPQ service’s image name directly into the <code>docker-compose.yml</code> file, we instead opt to use the special <a href="https://docs.docker.com/compose/environment-variables/#the-env-file">Docker-Compose <code>.env</code> file</a> to hold environment variables for these values. Later, when Docker-Compose is launched, these variables are automatically substituted into the <code>docker-compose.yml</code> file.</p>
<p>It’s important to understand that the image names used in our <code>.env</code> file are DockerHub-valid image names in the form of:</p>
<p><code>&lt;dockerhub-organization&gt;/&lt;repository-name&gt;:&lt;tag&gt;</code></p>
<p>For example, <code>openpowerquality/view:1.2.8</code></p>
<p>Why does this matter? Because when Docker-Compose launches on the host system (or in our case, when we invoke the <code>docker-compose.run.sh</code> script), it will automatically pull these images from DockerHub if they have not been previously downloaded. As you can imagine, this greatly simplifies the deployment process. Updating the system to run on the latest OPQ images is essentially just a matter of grabbing the latest <code>.env</code> file.</p>
<p>Our approach to image publication takes advantage of this <code>.env</code> file:</p>
<p>Each service’s respective <code>docker-publish.sh</code> script parses the Docker-Compose <code>.env</code> file for the appropriate image name.
Since these image names are, in fact, valid DockerHub repository image names, our <code>docker-publish.sh</code> script uses the image name to tag and push to DockerHub.</p>
<p>When a developer wishes to publish a new version of an OPQ service, it is simply a matter of modifying the <code>.env</code> file
with the new desired version prior to running the <code>docker-publish.sh</code> script.</p>
<p>It’s the developer’s responsibility to remember to commit the updated <code>.env</code> file to the GitHub repository.</p>
<p>By doing so, the developer ensures that:</p>
<ol>
<li>The world is aware of the latest available Docker image versions for each OPQ service.</li>
<li>We can easily correlate OPQ releases with Git history</li>
</ol>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="cloud-port-map.html">← OPQ Cloud Port Map</a><a class="docs-next button" href="emilia-ssh.html">Emilia SSH Access →</a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#overview">Overview</a></li><li><a href="#docker-and-docker-compose">Docker and Docker Compose</a></li><li><a href="#docker-file-structure">Docker file structure</a></li><li><a href="#build-an-image">Build an image</a></li><li><a href="#publish-image-to-dockerhub">Publish image to DockerHub</a></li><li><a href="#publish-example">Publish example</a><ul class="toc-headings"><li><a href="#update-the-env-file">Update the <code>.env</code> file</a></li><li><a href="#login-to-dockerhub">Login to DockerHub</a></li><li><a href="#invoke-the-publish-script">Invoke the publish script</a></li><li><a href="#commit-and-push-the-updated-env-file-to-github">Commit and push the updated <code>.env</code> file to GitHub</a></li></ul></li><li><a href="#overview-of-opq-docker-files">Overview of OPQ Docker files</a><ul class="toc-headings"><li><a href="#opq-cloud-docker-files">OPQ Cloud Docker files</a></li><li><a href="#docker-compose-files">Docker-Compose files</a></li><li><a href="#utility-files">Utility files</a></li></ul></li><li><a href="#understanding-docker-compose-and-the-env-file-">Understanding Docker-Compose and the .env file</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/opqlogo_white.png" alt="Open Power Quality" width="66" height="58"/></a><div><h5>Documentation Quick Links</h5><a href="/docs/intro-opq.html">Overview</a><a href="/docs/userguide-hardware.html">OPQ Box User Guide</a><a href="/docs/userguide-software.html">OPQ View User Guide</a><a href="/docs/other-agile-power-monitoring.html">Agile Power Monitoring for UH</a><a href="/docs/other-roadmap.html">Roadmap</a></div><div><h5>Community</h5><a href="https://openpowerquality.slack.com/" target="_blank" rel="noreferrer noopener">Slack</a><a href="https://twitter.com/opquality" target="_blank" rel="noreferrer noopener">Twitter</a><a href="/blog">News</a><a href="http://emilia.ics.hawaii.edu">Emilia (public OPQ View)</a><a href="/contact-us.html">Contact Us</a></div><div><h5>Development</h5><a href="https://github.com/openpowerquality">GitHub</a><a href="https://github.com/openpowerquality/opq/projects">Project Boards</a><a href="/team.html">Developer Team</a><a href="/docs/opportunities.html">Opportunities</a></div></section><p style="text-align:center;color:#e9faff">Open Power Quality is sponsored by:<br/><a style="text-align:center;color:#e9faff" href="http://csdl.ics.hawaii.edu">Collaborative Software Development Laboratory, University of Hawaii</a><br/><a style="text-align:center;color:#e9faff" href="http://www.ics.hawaii.edu">Department of Information and Computer Sciences, University of Hawaii</a><br/><a style="text-align:center;color:#e9faff" href="http://ee.hawaii.edu">Department of Electrical Engineering, University of Hawaii</a><br/></p></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              var search = docsearch({
                
                apiKey: '9bf16cc78135dbeeb3826894ebbbb2ee',
                indexName: 'openpowerquality',
                inputSelector: '#search_input_react'
              });
            </script></body></html>